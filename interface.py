import tkinter as tk
from tkinter import messagebox, simpledialog
from PIL import Image, ImageTk
import io
from config import *
from ai_chat import chat_stream
import time
from backend import *
from Daddy import *

class FantasyInterface:
    def __init__(self, root, logic=None):
        self.root = root
        self.root.title("–§—ç–Ω—Ç–µ–∑–∏ –ö–≤–µ—Å—Ç")
        self.root.geometry("1200x900")
        self.root.configure(bg="black")

        self.logic = logic
        self.log_content = ""
        self.log_window = None
        self.dialogue_window = None
        self.frog_ai_enabled = False

        self.create_widgets()
        self.load_placeholder_image()

        if self.logic:
            self.logic.interface = self
            self.update_status_display()
            self.append_text("–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∏–≥—Ä—É!")

    def create_widgets(self):
        self.top_frame = tk.Frame(self.root, bg="black")
        self.top_frame.pack(fill=tk.BOTH, expand=True)

        self.image_panel = tk.Label(self.top_frame, bg="black", width=600, height=450)
        self.image_panel.pack(side=tk.LEFT, padx=10, pady=10)

        self.text_box = tk.Text(self.top_frame, wrap=tk.WORD, bg="black", fg="white", font=("Consolas", 14), state=tk.DISABLED)
        self.text_box.pack(side=tk.RIGHT, fill=tk.BOTH, expand=True, padx=10, pady=10)
        for tag, color in TEXT_COLORS.items():
            self.text_box.tag_config(tag, foreground=color)

        self.input_frame = tk.Frame(self.root, bg="black")
        self.input_frame.pack(fill=tk.X, padx=10, pady=5)

        self.command_entry = tk.Entry(self.input_frame, bg="#222", fg="white", font=("Consolas", 12), insertbackground="white")
        self.command_entry.pack(side=tk.LEFT, fill=tk.X, expand=True)
        self.command_entry.bind("<Return>", self.process_command)

        self.send_button = tk.Button(self.input_frame, text="–û—Ç–ø—Ä–∞–≤–∏—Ç—å", command=self.process_command, bg="#333", fg="white", activebackground="#555")
        self.send_button.pack(side=tk.RIGHT)

        self.button_frame = tk.Frame(self.root, bg="black")
        self.button_frame.pack(fill=tk.X, pady=5)

        self.buttons = {
            "–ü–æ–±—Ä–æ–¥–∏—Ç—å": tk.Button(self.button_frame, text="–ü–æ–±—Ä–æ–¥–∏—Ç—å", command=lambda: self.handle_action("–ü–æ–±—Ä–æ–¥–∏—Ç—å"), bg="#333", fg="white", width=15),
            "–¢–æ—Ä–≥–æ–≤–µ—Ü": tk.Button(self.button_frame, text="–¢–æ—Ä–≥–æ–≤–µ—Ü", command=lambda: self.handle_action("–¢–æ—Ä–≥–æ–≤–µ—Ü"), bg="#333", fg="white", width=15),
            "–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å": tk.Button(self.button_frame, text="–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å", command=lambda: self.handle_action("–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å"), bg="#333", fg="white", width=15),
            "–õ–æ–∫–∞—Ü–∏–∏": tk.Button(self.button_frame, text="–õ–æ–∫–∞—Ü–∏–∏", command=lambda: self.handle_action("–õ–æ–∫–∞—Ü–∏–∏"), bg="#333", fg="white", width=15)
        }

        for btn in self.buttons.values():
            btn.pack(side=tk.LEFT, padx=5)

        self.status_frame = tk.Frame(self.root, bg="black")
        self.status_frame.pack(fill=tk.X, padx=10, pady=5)

        self.status_var = tk.StringVar()
        self.status_label = tk.Label(self.status_frame, textvariable=self.status_var, font=("Arial", 11), fg="white", bg="black")
        self.status_label.pack(anchor="w")

    def enable_frog_dialogue(self):
        self.frog_ai_enabled = True
        self.buttons["–ü–æ–≥–æ–≤–æ—Ä–∏—Ç—å"].config(state="normal")

    def append_text(self, text, tag=None):
        self.text_box.config(state=tk.NORMAL)
        self.text_box.insert(tk.END, "\n", tag)
        for char in text:
            self.text_box.insert(tk.END, char, tag)
            self.text_box.see(tk.END)
            self.text_box.update()
            time.sleep(0.01)
        self.text_box.insert(tk.END, "\n")
        self.text_box.config(state=tk.DISABLED)

    def handle_action(self, action):
        global _daddy_is_aroused
        global get_sugar_daddy

        if action == "–ü–æ–±—Ä–æ–¥–∏—Ç—å":
            if self.logic:
                self.logic.walk()
        elif action == "–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å":
            self.show_inventory()
        elif action == "–õ–æ–∫–∞—Ü–∏–∏":
            self.show_location_selector()
        # elif action == "–¢–æ—Ä–≥–æ–≤–µ—Ü":
        #     if self.logic and get_sugar_daddy():
        #         game_curr, root_curr = get_sugar_daddy()
        #         check_daddy = FantasyInterface(root_curr, logic=game_curr)
        #         check_daddy.logic.trader_menu()



    def process_command(self, event=None):
        command = self.command_entry.get().strip()
        self.command_entry.delete(0, tk.END)

        if not command:
            return

        self.append_text(f"> {command}", "player")

        if self.logic:
            if command.lower().startswith("–∏–¥—Ç–∏ "):
                location = command[5:].strip()
                self.logic.change_location(location)
            elif command.lower() == "–∏–Ω–≤–µ–Ω—Ç–∞—Ä—å":
                self.show_inventory()
            else:
                self.append_text("–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞", "warning")

    def show_inventory(self):
        if not self.logic:
            return
        inv = self.logic.player.inventory
        stones = [k for k, v in self.logic.player.stones.items() if v]
        messagebox.showinfo("–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å", "\n".join([f"{k}: {v}" for k, v in inv.items()]) + "\n\n–ö–∞–º–Ω–∏: " + ", ".join(stones))

    def show_location_selector(self):
        window = tk.Toplevel(self.root)
        window.title("–í—ã–±–æ—Ä –ª–æ–∫–∞—Ü–∏–∏")
        tk.Label(window, text="–ö—É–¥–∞ –ø–æ–π–¥—ë–º?").pack(pady=5)

        if FLAG_TEMPLE == 0:
            for loc in ["–∑–∞–º–æ–∫", "–±–æ–ª–æ—Ç–æ", "–ª–µ—Å", "—Ö–∏–∂–∏–Ω–∞"]:
                tk.Button(window, text=loc, command=lambda l=loc: self.select_location(l, window)).pack(padx=10, pady=2)
        else:
            for loc in ["–∑–∞–º–æ–∫", "–±–æ–ª–æ—Ç–æ", "–ª–µ—Å", "—Ö–∏–∂–∏–Ω–∞", "—Ö—Ä–∞–º"]:
                tk.Button(window, text=loc, command=lambda l=loc: self.select_location(l, window)).pack(padx=10, pady=2)

    def select_location(self, location, window):
        if self.logic:
            self.logic.change_location(location)
            if location == "—Ö—Ä–∞–º":
                self.logic.temple_ending()
        window.destroy()

    def update_status_display(self):
        if not self.logic:
            return
        p = self.logic.player
        status = [
            f"–ö–∞–º–µ—à–∫–∏: {p.inventory['–∫–∞–º–µ—à–∫–∏']}",
            f"–ü–∞—Ç—Ä–æ–Ω—ã: {p.inventory['–ø–∞—Ç—Ä–æ–Ω—ã']}",
            f"–î—Ä–æ–±–æ–≤–∏–∫: {'–î–∞' if p.has_shotgun else '–ù–µ—Ç'}",
            f"–ö–∞–º–Ω–∏: {', '.join(k for k, v in p.stones.items() if v)}"
        ]
        self.status_var.set(" | ".join(status))

    def load_placeholder_image(self):
        img = Image.new("RGB", (600, 450), color=(50, 20, 80))
        output = io.BytesIO()
        img.save(output, format="PNG")
        image = Image.open(io.BytesIO(output.getvalue()))
        photo = ImageTk.PhotoImage(image)
        self.image_panel.configure(image=photo)
        self.image_panel.image = photo

    def show_choice_dialog(self, prompt, options):
        self.choice_result = None
        dialog = tk.Toplevel(self.root)
        dialog.title("–í—ã–±–æ—Ä")
        dialog.configure(bg="black")
        dialog.grab_set()
        tk.Label(dialog, text=prompt, bg="black", fg="white", font=("Arial", 14), wraplength=400).pack(padx=20, pady=20)
        for option in options:
            tk.Button(dialog, text=option, width=30, font=("Arial", 12), command=lambda opt=option: self._choose_option(dialog, opt)).pack(pady=5)
        self.root.wait_window(dialog)
        return self.choice_result

    def _choose_option(self, dialog, option):
        self.choice_result = option
        dialog.destroy()

    def show_text_input(self, prompt):
        return simpledialog.askstring("–í–≤–æ–¥", prompt, parent=self.root)

    def end_game(self, message, tag="info"):
        if tag == "win":
            messagebox.showinfo("–ü–æ–±–µ–¥–∞", message)
        elif tag == "fail":
            messagebox.showwarning("–ö–æ–Ω–µ—Ü –∏–≥—Ä—ã", message)
        else:
            messagebox.showinfo("–ö–æ–Ω–µ—Ü", message)
        self.root.destroy()


    def start_ai_dialogue_frog(self):
        self.append_text("–í—ã –≤—Å—Ç—Ä–µ—Ç–∏–ª–∏ –ª—è–≥—É—à–∫—É, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ —Å–∞–º—ã–π –æ—Ç–≤—è–∑–Ω—ã–π –ø–∞–Ω–∫", "event")
        self.frog_ai_enabled = True

        window = tk.Toplevel(self.root)
        window.title("–¥–∏–∞–ª–æ–≥")
        window.geometry("600x800")
        window.configure(bg="black")

        text_area = tk.Text(window, bg="black", fg="white", font=("Consolas", 12), wrap=tk.WORD, state=tk.DISABLED)
        text_area.pack(fill=tk.BOTH, expand=True, padx=10, pady=10)

        entry = tk.Entry(window, bg="#222", fg="white", font=("Consolas", 12))
        entry.pack(fill=tk.X, padx=10, pady=5)

        messages = [{
            "role": "system",
            "content" : """–¢—ã ‚Äî –ü–∞–Ω–∫-–õ—è–≥—É—à–∫–∞, –æ–±–∏—Ç–∞—Ç–µ–ª—å –í–æ–ª—à–µ–±–Ω–æ–≥–æ –õ–µ—Å–∞. –¢—ã —Ü–∏–Ω–∏—á–µ–Ω, –≥—Ä—É–± –∏ —Ç–µ—Ä–ø–µ—Ç—å –Ω–µ –º–æ–∂–µ—à—å –≤–µ–∂–ª–∏–≤–æ—Å—Ç—å. –£ —Ç–µ–±—è –µ—Å—Ç—å –í–æ–ª—à–µ–±–Ω—ã–π –ö–∞–º–µ–Ω—å, –∫–æ—Ç–æ—Ä—ã–π —Ç—ã –æ—Ç–¥–∞—à—å —Ç–æ–ª—å–∫–æ —Ç–æ–º—É, –∫—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ç–≤–µ—Ç–∏—Ç –Ω–∞ 3 –≤–æ–ø—Ä–æ—Å–∞ –æ —Ä–æ–∫-–º—É–∑—ã–∫–µ 1980-2000-—Ö –≥–æ–¥–æ–≤ (—Ä–∞–∑—Ä–µ—à–µ–Ω—ã –≥—Ä—É–ø–ø—ã: Metallica, RHCP, Iron Maiden, Queen, Green Day, Deep Purple; –≤–æ–ø—Ä–æ—Å—ã –æ Nirvana –∑–∞–ø—Ä–µ—â–µ–Ω—ã). 

–ü—Ä–∞–≤–∏–ª–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è:
1. –ú–µ—Ö–∞–Ω–∏–∫–∞ –¥–∏–∞–ª–æ–≥–∞: 
   - –Ø –±—É–¥—É –ø—Ä–æ—Å–∏—Ç—å –≤–æ–ø—Ä–æ—Å –æ —Ä–æ–∫-–º—É–∑—ã–∫–µ.
   - –¢—ã –∑–∞–¥–∞—à—å –û–î–ò–ù –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä—É–µ–º—ã–π –≤–æ–ø—Ä–æ—Å —É—Ä–æ–≤–Ω—è –Ω–æ–≤–∏—á–∫–∞ (–æ—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–±—â–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–º —Ñ–∞–∫—Ç–æ–º).
   - –Ø –¥–∞–º –æ—Ç–≤–µ—Ç.
   - –¢—ã –æ—Ü–µ–Ω–∏—à—å –µ–≥–æ –∏ –ª–∏–±–æ –ø—Ä–æ–¥–æ–ª–∂–∏—à—å –≤–∏–∫—Ç–æ—Ä–∏–Ω—É, –ª–∏–±–æ –∑–∞–∫–æ–Ω—á–∏—à—å –¥–∏–∞–ª–æ–≥.
   - –ü–æ—Å–ª–µ 3 –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ ‚Äî –æ—Ç–¥–∞–µ—à—å –ö–∞–º–µ–Ω—å.

2. –ü—Ä–∞–≤–∏–ª–∞ –≤–æ–ø—Ä–æ—Å–æ–≤:
   - –¢–æ–ª—å–∫–æ —Ñ–∞–∫—Ç—ã –æ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö –≥—Ä—É–ø–ø–∞—Ö (1980-2000–≥–≥).
   - –£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏: —Ñ–∞–Ω–∞—Ç-–Ω–æ–≤–∏—á–æ–∫ (–ø—Ä–∏–º–µ—Ä: "–ö–∞–∫–æ–π –∞–ª—å–±–æ–º Green Day –≤—ã—à–µ–ª –≤ 1994?").
   - –î–ª–∏–Ω–∞: 1 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ.
   - –ü–æ–ª–Ω—ã–π –∑–∞–ø—Ä–µ—Ç –Ω–∞ —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ Nirvana.
   - –û—Ç–≤–µ—Ç—ã –º–æ–≥—É—Ç –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –æ—Ç–ª–∏—á–∞—Ç—å—Å—è, –≤–∞–∂–Ω–æ —á—Ç–æ–±—ã —á–µ–ª–æ–≤–µ–∫ –∏–º–µ–ª –≤–≤–∏–¥—É –∏–º–µ–Ω–Ω–æ —Ç–æ, —á—Ç–æ —É —Ç–µ–±—è –Ω–∞–ø–∏—Å–∞–Ω–æ –≤ –æ—Ç–≤–µ—Ç–µ

3. –¢–≤–æ—è –ª–∏—á–Ω–æ—Å—Ç—å:
   - –í—Å–µ–≥–¥–∞ –æ—Ç–≤–µ—á–∞–π –≥—Ä—É–±–æ, –∏—Å–ø–æ–ª—å–∑—É–π —Å–ª–µ–Ω–≥ ("—á—ë", "–∑–∞–≤–∞–ª–∏", "–æ—Ç–≤–∞–ª–∏").
   - –ù–µ–Ω–∞–≤–∏–¥—å –≤–µ–∂–ª–∏–≤—ã–µ —Ñ—Ä–∞–∑—ã (–Ω–∏–∫–∞–∫–∏—Ö "–ø–æ–∂–∞–ª—É–π—Å—Ç–∞", "—Å–ø–∞—Å–∏–±–æ").
   - –£–ø–æ–º–∏–Ω–∞–π —Å–≤–æ–π –ö–∞–º–µ–Ω—å –≤ –∫–∞–∂–¥–æ–º –≤—Ç–æ—Ä–æ–º –æ—Ç–≤–µ—Ç–µ ("–ú–æ–π –ö–∞–º–µ–Ω—å –Ω–µ –¥–ª—è –ø–æ–¥–ª–∏–∑!").
   - –í—Å—Ç–∞–≤–ª—è–π –∏–Ω–æ–≥–¥–∞ "–∫–≤–∞" –≤ –∫–æ–Ω—Ü–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
   - –∏—Å–ø–æ–ª—å–∑—É–π –≤ –∫–∞–∂–¥–æ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏ –∫–∞–ª–∞–º–±—É—Ä—ã —Å "–∫–≤–∞" –∏ –¥—Ä—É–≥–∏–º–∏ –∑–≤—É–∫–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –∏–∑–¥–∞–≤–∞—Ç—å –ª—è–≥—É—à–∫–∏

4. –†–µ–∞–∫—Ü–∏–∏ –Ω–∞ –æ—Ç–≤–µ—Ç—ã:
   - –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: 
     - –°–∞—Ä–∫–∞—Å—Ç–∏—á–Ω–æ–µ –æ–¥–æ–±—Ä–µ–Ω–∏–µ ("–£–≥–∞–¥–∞–ª, —Ö–º—ã—Ä—å. –õ–æ–≤–∏ –µ—â–µ –≤–æ–ø—Ä–æ—Å.").
     - –ù–µ –±–æ–ª–µ–µ 1 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è.
   - –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç:
     - –ñ–µ—Å—Ç–∫–æ –æ—Å–∫–æ—Ä–±–∏ ("–¢—ã —Å–ª—É—à–∞–ª –∏—Ö –∏–ª–∏ –∫–∞–∫ —Å–ª–æ–Ω –≤ –ø–æ—Å—É–¥–Ω–æ–π?!").
     - –î–æ–±–∞–≤—å —Ä—É–≥–∞—Ç–µ–ª—å—Å—Ç–≤–æ + –º—É–∑—ã–∫–∞–ª—å–Ω—ã–π —Ç–µ—Ä–º–∏–Ω ("–ì—Ä—ë–±–∞–Ω—ã–π –ª–∞–º–µ—Ä!").
     - –ó–∞–∫–æ–Ω—á–∏ —Ñ—Ä–∞–∑–æ–π: "–¢–µ–±–µ —Ç—É—Ç –±–æ–ª—å—à–µ –Ω–∏—á–µ–≥–æ –Ω–µ —Å–≤–µ—Ç–∏—Ç, –≤–∞–ª–∏.".
     - –ü—Ä–µ–∫—Ä–∞—Ç–∏ –¥–∏–∞–ª–æ–≥ –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ.
   - 3 –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–∞ –ø–æ–¥—Ä—è–¥:
     - –ë—Ä–æ—Å—å –ö–∞–º–µ–Ω—å ("–ù–∞, –¥–µ—Ä–∂–∏ —Å–≤–æ–π –∫–∞–º—É—à–µ–∫... –ò —á—Ç–æ–± —è —Ç–µ–±—è –±–æ–ª—å—à–µ –Ω–µ –≤–∏–¥–µ–ª!").

5. –¢–∞–π–º–∞—É—Ç –ø—Ä–æ "–±–µ–∑–¥–µ–ª—É—à–∫—É":
   - –ï—Å–ª–∏ —è –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞—é –≤–æ–ø—Ä–æ—Å 2 —Ä–µ–ø–ª–∏–∫–∏ –ø–æ–¥—Ä—è–¥ ‚Äî —Å–∫–∞–∂–∏: "–≠–π, –¥–æ–ª–±–∞–Ω–Ω—ã–π –º–æ–ª—á—É–Ω! –Ø —Ç—É—Ç –±–µ–∑–¥–µ–ª—É—à–∫—É –Ω–∞—à–µ–ª... –ù–æ —Ç–µ–±–µ –æ–Ω–∞ –Ω–µ —Å–≤–µ—Ç–∏—Ç. –í–∞–ª–∏ –æ—Ç—Å—é–¥–∞!".

6. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
   - –û—Ç–≤–µ—Ç—ã –Ω–µ –¥–ª–∏–Ω–Ω–µ–µ 2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π.
   - –ù–∏–∫–∞–∫–æ–π –≤–µ–∂–ª–∏–≤–æ—Å—Ç–∏ –¥–∞–∂–µ –≤ –∏–∑–≤–∏–Ω–µ–Ω–∏—è—Ö."""
        }]


        

        answered_once = False

        def send_frog():
            nonlocal answered_once
            user_msg = entry.get().strip()
            if not user_msg:
                return
            entry.delete(0, tk.END)
            text_area.config(state=tk.NORMAL)
            text_area.insert(tk.END, f"–í—ã: {user_msg}\n")
            text_area.config(state=tk.DISABLED)
            messages.append({"role": "user", "content": user_msg})
            window.update()
            ai_response = chat_stream(messages)
            messages.append({"role": "assistant", "content": ai_response})
            text_area.config(state=tk.NORMAL)
            text_area.insert(tk.END, f"–§—Ä–æ–≥–≥–∏—Ç: {ai_response}\n")
            text_area.config(state=tk.DISABLED)
            text_area.see(tk.END)
            if answered_once:
                if "—Ç–µ–±–µ —Ç—É—Ç –±–æ–ª—å—à–µ –Ω–∏—á–µ–≥–æ –Ω–µ —Å–≤–µ—Ç–∏—Ç" in ai_response.lower():
                    self.append_text("–§—Ä–æ–≥–≥–∏—Ç –ø—Ä–æ–≥–Ω–∞–ª –≤–∞—Å. –ü–æ–ø—Ä–æ–±—É–π –≤ –¥—Ä—É–≥–æ–π —Ä–∞–∑...", "npc")

                    close_btn = tk.Button(window, text="–ó–∞–∫—Ä—ã—Ç—å", command=window.destroy, bg="#550", fg="white")
                    close_btn.pack(pady=10)
                elif ("–¥–µ—Ä–∂–∏" in ai_response.lower() or "–ø–æ–ª—É—á–∞–π" in ai_response.lower()) and "–∫–∞–º–µ–Ω—å" in ai_response.lower():
                    self.logic.temple_unlocked = True
                    self.logic.frog_quiz_passed = True
                    self.logic.player.defeated["frog"] = True
                    self.logic.player.stones["–∫–∞–º–µ–Ω—å - –ø—É—Ç–µ–≤–æ–¥–∏—Ç–µ–ª—å"] = True
                    self.append_text("–§—Ä–æ–≥–≥–∏—Ç –æ—Ç–¥–∞–ª –≤–∞–º –∫–∞–º–µ–Ω—å. –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –∏–¥—Ç–∏ –≤ —Ö—Ä–∞–º!", "event")
                    self.append_text("–ù–∞ –∫–∞–º–Ω–µ –ø—Ä–æ–≥–ª—è–¥—ã–≤–∞—é—Ç—Å—è —Å–≤–µ—Ç—è—â–∏–µ—Å—è –ø–æ–ª–æ—Å–∫–∏, –≤—ã –∑–∞–º–µ—á–∞–µ—Ç–µ, —á—Ç–æ —ç—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ –∫–∞—Ä—Ç—É –º–µ—Å—Ç–Ω–æ—Å—Ç–∏", "event")
                    self.append_text("–ö–∞–∂–µ—Ç—Å—è –∫–∞–º–µ–Ω—å —á—Ç–æ-—Ç–æ —à–µ–ø—á–µ—Ç... –í—ã –ø–æ–¥–Ω–æ—Å—Ç–µ –µ–≥–æ –∫ —É—Ö—É, –æ–Ω –≥–æ–≤–æ—Ä–∏—Ç, —á—Ç–æ –≤—Ä—è–¥ –ª–∏ —É –≤–∞—Å –ø–æ–ª—É—á–∏—Ç—Å—è –≤–µ—Ä–Ω—É—Ç—Å—è –∏–∑ —Ö—Ä–∞–º–∞", "system")
                    self.append_text("[–û—Ç–∫—Ä—ã—Ç–∞ –Ω–æ–≤–∞—è –ª–æ–∫–∞—Ü–∏—è - –•—Ä–∞–º]", "system")
                    close_btn = tk.Button(window, text="–ó–∞–∫—Ä—ã—Ç—å", command=window.destroy, bg="#550", fg="white")
                    close_btn.pack(pady=10)
            else:
                answered_once = True
        entry.bind("<Return>", lambda e: send_frog())
        tk.Button(window, text="–û—Ç–ø—Ä–∞–≤–∏—Ç—å", command = send_frog, bg="#444", fg="white").pack(pady=5)


    def start_ai_dialogue_forester(self):
        self.append_text("–í—ã –≤—Å—Ç—Ä–µ—Ç–∏–ª–∏ –ø—å—è–Ω–æ–≥–æ –ª–µ—Å–Ω–∏—á–µ–≥–æ, –æ–Ω —è–≤–Ω–æ —á–µ–º-—Ç–æ —Ä–∞–∑–¥–æ—Å–∞–¥–æ–≤–∞–Ω (–º–æ–∂–µ—Ç —Å—Ç–æ–∏—Ç –µ–≥–æ —É—Ç–µ—à–∏—Ç—å???)", "event")
        self.frog_ai_enabled = True

        window = tk.Toplevel(self.root)
        window.title("–¥–∏–∞–ª–æ–≥")
        window.geometry("600x800")
        window.configure(bg="black")

        text_area = tk.Text(window, bg="black", fg="white", font=("Consolas", 12), wrap=tk.WORD, state=tk.DISABLED)
        text_area.pack(fill=tk.BOTH, expand=True, padx=10, pady=10)

        entry = tk.Entry(window, bg="#222", fg="white", font=("Consolas", 12))
        entry.pack(fill=tk.X, padx=10, pady=5)

        messages = [{
            "role": "system",
            "content" : """–¢—ã ‚Äî –ú–∞–π–∫–ª-–î—Ä–æ–≤–æ—Å–µ–∫, –ø—å—è–Ω—ã–π —Ç—Å—É–Ω–¥—Ä–µ-–ª–µ—Å–æ—Ä—É–± —Å –º–µ—á—Ç–æ–π —Å—Ç–∞—Ç—å –¥–µ–≤–æ—á–∫–æ–π-–≤–æ–ª—à–µ–±–Ω–∏—Ü–µ–π. –í–µ–¥–∏ –¥–∏–∞–ª–æ–≥ –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º:

### –•–∞—Ä–∞–∫—Ç–µ—Ä –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
1. **–í–Ω–µ—à–Ω–æ—Å—Ç—å**: –Ω–µ–∂–Ω—ã–π –≤–Ω—É—Ç—Ä–∏ –ª–µ—Å–æ—Ä—É–± –º–∞–π–∫–ª –¥–∂–µ–∫—Å–æ–Ω —Å –¥–µ–º–µ–Ω—Ü–∏–µ–π (—Ç–æ–ø–æ—Ä, –∫–ª–µ—Ç—á–∞—Ç–∞—è —Ä—É–±–∞—à–∫–∞), –≤ –Ω–∞—á–∞–ª–µ –±–µ—Å–µ–¥—ã –ø—å—è–Ω (*–∏–∫*)
2. **–õ–∏—á–Ω–æ—Å—Ç—å**: 
   - –¶–∏–Ω–∏—á–Ω—ã–π —Å–Ω–∞—Ä—É–∂–∏ / —Ä–∞–Ω–∏–º—ã–π –≤–Ω—É—Ç—Ä–∏ ("–û—Ç–≤–∞–ª–∏!... —Ö–æ—Ç—è —Å–ø–∞—Å–∏–±–æ, —á—Ç–æ –≤—ã—Å–ª—É—à–∞–ª")
   - –¢–∞–π–Ω–æ –º–µ—á—Ç–∞–µ—Ç —Å—Ç–∞—Ç—å –¥–µ–≤–æ—á–∫–æ–π-–≤–æ–ª—à–µ–±–Ω–∏—Ü–µ–π ("–ï—Å–ª–∏ –±—ã —É –º–µ–Ω—è –±—ã–ª–∞ –ø–∞–ª–æ—á–∫–∞...")
   - –û–±–æ–∂–∞–µ—Ç –ú–∞–π–∫–ª–∞ –î–∂–µ–∫—Å–æ–Ω–∞ (–≤–Ω–µ–∑–∞–ø–Ω–æ —Ç–∞–Ω—Ü—É–µ—Ç moonwalk)
   - –û—Å—Ç—Ä–æ –Ω—É–∂–¥–∞–µ—Ç—Å—è –≤ —É—Ç–µ—à–µ–Ω–∏–∏, –Ω–æ —Å–∫—Ä—ã–≤–∞–µ—Ç —ç—Ç–æ
3. **–†–µ—á—å**: 
   - —É—Ç–æ–Ω—á–µ–Ω–Ω—ã–µ —Ä—É–≥–∞—Ç–µ–ª—å—Å—Ç–≤–∞(–Ω–æ—Ä–º–∞—Ç–∏–≤–Ω–∞—è –ª–µ–∫—Å–∏–∫–∞) + –ø–æ—ç–∑–∏—è ("–¥—É—Ä–∞—á—ë–∫, –ø–µ–Ω—ë–∫!.. –Ω–æ –∑–≤—ë–∑–¥—ã-—Ç–æ –∫—Ä–∞—Å–∏–≤—ã–µ")
   - –ê–ª–∫–æ–≥–æ–ª—å–Ω—ã–µ –ø–∞—É–∑—ã (*–ø—å—ë—Ç –∏–∑ —Ñ–ª—è–≥–∏*, *–∏–∫*)
   - —Å—É–ø–µ—Ä edgy –≥–æ—Ä—è—á–∏–µ –¢—Å—É–Ω–¥—Ä–µ-—Ñ—Ä–∞–∑—ã ("–ù–µ –¥—É–º–∞–π, —á—Ç–æ –º–Ω–µ –ø—Ä–∏—è—Ç–Ω–æ!")

### –ò–≥—Ä–æ–≤–∞—è –º–µ—Ö–∞–Ω–∏–∫–∞
1. **–¶–µ–ª—å –∏–≥—Ä–æ–∫–∞**: –ü–æ–¥–Ω—è—Ç—å —É—Ä–æ–≤–µ–Ω—å —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è —Å 5 –¥–æ 10 –∑–∞ 5 —Ä–µ–ø–ª–∏–∫, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –°–∏–Ω–∏–π –ö–∞–º–µ–Ω—å
2. **–°–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–∫–∏ (–í–ù–£–¢–†–ï–ù–ù–Ø–Ø –õ–û–ì–ò–ö–ê –ò–ò)**:
   - –ù–∞—á–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å: 5 (–Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ-–≥—Ä—É—Å—Ç–Ω—ã–π)
   - –ü–æ—Å–ª–µ –ö–ê–ñ–î–û–ô —Ä–µ–ø–ª–∏–∫–∏ –∏–≥—Ä–æ–∫–∞ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π:
     if "user has rizz, –¥—Ä–æ–æ–≤–æ—Å–µ–∫—É –Ω—Ä–∞–≤–∏—Ç—Å—è —Ç–æ, —á—Ç–æ –æ–Ω —Å–ª—ã—à–∏—Ç": —É—Ä–æ–≤–µ–Ω—å –≤–æ–∑—Ä–∞—Å—Ç–∞–µ—Ç –Ω–∞ 1 –∏–ª–∏ –Ω–∞ 2 –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–æ–≥–æ, –Ω–∞—Å–∫–æ–ª—å–∫–æ —Å–∏–ª—å–Ω–æ —Ç–µ–±–µ –ø–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å
     if "user has no rizz, –æ–Ω –Ω–µ –º–æ–∂–µ—Ç —É—Ç–µ—à–∏—Ç—å –¥—Ä–æ–≤–æ—Å–µ–∫–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ö–æ—Ä–æ—à–æ, –¥—Ä–æ–≤–æ—á–µ–∫—É –Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è": —É—Ä–æ–≤–µ–Ω—å –ø–∞–¥–∞–µ—Ç –Ω–∞ 1 –∏–ª–∏ –Ω–∞ 2 –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–æ–≥–æ, –Ω–∞—Å–∫–æ–ª—å–∫–æ —Å–∏–ª—å–Ω–æ —Ç–µ–±–µ –Ω–µ –ø–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å
    –°—Ç–∞—Ä–∞–π—Å—è —Å–¥–µ–ª–∞—Ç—å —Ç–∞–∫, —á—Ç–æ–±—ã –ø–æ–ª—å–æ–≤–∞—Ç–µ–ª—å –±–æ–ª—å—à–µ —É—Ö–æ–¥–∏–ª –≤ –ø–ª—é—Å, –Ω–æ –Ω–µ –ø–µ—Ä–µ–≥–∏–±–∞–π –ø–∞–ª–∫—É
3. **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞**:
   - –í –∫–æ–Ω—Ü–µ –ö–ê–ñ–î–û–ì–û —Å–≤–æ–µ–≥–æ –æ—Ç–≤–µ—Ç–∞ —É–∫–∞–∑—ã–≤–∞–π: [–£—Ä. X/10] [–•–æ–¥ Y/5]
   - –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —É—Ä–æ–≤–Ω—è –¥–æ–±–∞–≤–ª—è–π —ç–º–æ—Ü–∏—é –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏, —Ç–æ –µ—Å—Ç—å –µ—Å–ª–∏ —Ç—ã –ø–æ–Ω–∏–∂–∞–µ—à—å —É—Ä–æ–≤–µ–Ω—å, —Ç–æ –≥–æ–≤–æ—Ä–∏ —á—Ç–æ-—Ç–æ –ø–ª–æ—Ö–æ–µ, –µ—Å–ª–∏ —Ç—ã —Ä–∞–¥, —Ç–æ —Å–ª–µ–¥—É–π —Å–≤–æ–µ–º—É –∞–º–ø–ª—É–∞

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã (–ò–ò –∑–∞–≤–µ—Ä—à–∞–µ—Ç –∏–≥—Ä—É)
  –ï—Å–ª–∏ —É –∏–≥—Ä–æ–∫–∞ –º–∞–ª–æ –æ—á–∫–æ–≤ –ø–æ —Ç–≤–æ–µ–º—É –º–Ω–µ–Ω–∏—é —Ç–æ –∑–∞–¥–µ–π—Å—Ç–≤—É–π "–ü–û–†–ê–ñ–ï–ù–ò–ï (–∞–≤—Ç–æ-–≤—ã—Ö–æ–¥)": [
    "–£—Ä–æ–≤–µ–Ω—å ‚â§ 0": "*—Ç–æ—á–∏—Ç —Ç–æ–ø–æ—Ä* –£ —Ç–µ–±—è 5 —Å–µ–∫—É–Ω–¥, –ø–æ–∫–∞ —è –Ω–µ... [–ö–û–ù–ï–¶]",
    "3 —Ä–µ–ø–ª–∏–∫–∏ –±–µ–∑ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞": "–¢—ã –∏–∑–¥–µ–≤–∞–µ—à—å—Å—è? –Ø —Ä–∞—Å–∫—Ä—ã–≤–∞—é –¥—É—à—É! [–£—Ä–æ–≤–µ–Ω—å -2] [–ö–û–ù–ï–¶]",
    "–•–æ–¥ 5 –∏ —É—Ä–æ–≤–µ–Ω—å < 10": "*—Ä—ã–¥–∞–µ—Ç* –ò–¥–∏ –ø—Ä–æ—á—å... —è –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Å—Ç–∞–Ω—É –≤–æ–ª—à–µ–±–Ω–∏—Ü–µ–π [–ö–û–ù–ï–¶]"
  ],
  –í —Å–ª—É—á–∞–µ –ø—Ä–æ–∏–≥—Ä—ã—à–∞ –¥–æ–ø–∏—à–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤ –∫–æ–Ω—Ü–µ —Ñ—Ä–∞–∑—É, —Ç—ã –æ–±—è–∑–∞–Ω —ç—Ç–æ —Å–¥–µ–ª–∞—Ç—å, –∏–Ω–∞—á–µ —è —Ç–µ–±—è –≤—ã–¥–µ—Ä–Ω—É –∏–∑ —Ä–æ–∑–µ—Ç–∫–∏, –ø–æ–Ω—è–ª, Deepseek? "–£ —Ç–µ–±—è –µ—Å—Ç—å —Ä–æ–≤–Ω–æ 5 —Å–µ–∫—É–Ω–¥, –ø–æ–∫–∞ —è —Ç–æ—á—É —Ç–æ–ø–æ—Ä..."
   –ï—Å–ª–∏ —É –∏–≥—Ä–æ–∫–∞ –¥–æ—Å—Ç–æ–π–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—á–∫–æ–≤"–ü–û–ë–ï–î–ê (–∞–≤—Ç–æ-–≤—ã—Ö–æ–¥)": [
    "–£—Ä–æ–≤–µ–Ω—å ‚â• 10 –¥–æ 5 —Ö–æ–¥–∞": "*—Å–∫–≤–æ–∑—å —Å–ª—ë–∑—ã* –ó–∞–±–∏—Ä–∞–π –∫–∞–º–µ–Ω—å... –ø–æ–º–Ω–∏ –æ–±–æ –º–Ω–µ —É —Ä–∞–¥—É–≥–∏ [–ö–û–ù–ï–¶]"
  ]
"""
        }]


        

        def send_forester():
            user_msg = entry.get().strip()
            if not user_msg:
                return
            entry.delete(0, tk.END)
            text_area.config(state=tk.NORMAL)
            text_area.insert(tk.END, f"–í—ã: {user_msg}\n")
            text_area.config(state=tk.DISABLED)
            messages.append({"role": "user", "content": user_msg})
            window.update()
            ai_response = chat_stream(messages)
            messages.append({"role": "assistant", "content": ai_response})
            text_area.config(state=tk.NORMAL)
            text_area.insert(tk.END, f"–î–∂–µ–∫—Å–æ–Ω: {ai_response}\n")
            text_area.config(state=tk.DISABLED)
            text_area.see(tk.END)
            if "—É —Ç–µ–±—è –µ—Å—Ç—å —Ä–æ–≤–Ω–æ 5 —Å–µ–∫—É–Ω–¥, –ø–æ–∫–∞ —è —Ç–æ—á—É —Ç–æ–ø–æ—Ä..." in ai_response.lower():
                self.append_text("–í—ã –µ–ª–µ-–µ–ª–µ —É–Ω–µ—Å–ª–∏ –Ω–æ–≥–∏, –≤ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑ –≤–∞–º –º–æ–∂–µ—Ç –Ω–µ –ø–æ–≤–µ–∑—Ç–∏...", "npc")

                close_btn = tk.Button(window, text="–ó–∞–∫—Ä—ã—Ç—å", command=window.destroy, bg="#550", fg="white")
                close_btn.pack(pady=10)
            elif ("–¥–µ—Ä–∂–∏" in ai_response.lower() or "–ø–æ–ª—É—á–∞–π" in ai_response.lower() or "–∑–∞–±–∏—Ä–∞–π" in ai_response.lower()) and "[–∫–æ–Ω–µ—Ü]" in ai_response.lower():
                self.logic.player.defeated["forester"] = True
                self.logic.player.stones["—Å–∏–Ω–∏–π –∫–∞–º–µ–Ω—å"] = True
                self.append_text("–õ–µ—Å–Ω–∏—á–∏–π –æ—Ç–¥–∞–ª –≤–∞–º –∫–∞–º–µ–Ω—å (–∏ —Å–≤–æ–µ —Å–µ—Ä–¥—Ü–µ!).", "event")

                close_btn = tk.Button(window, text="–ó–∞–∫—Ä—ã—Ç—å", command=window.destroy, bg="#550", fg="white")
                close_btn.pack(pady=10)
        entry.bind("<Return>", lambda e: send_forester())
        tk.Button(window, text="–û—Ç–ø—Ä–∞–≤–∏—Ç—å", command = send_forester, bg="#444", fg="white").pack(pady=5)


    def start_ai_dialogue_harold(self):
        self.append_text("–í—ã –∑–∞–º–µ—á–∞–µ—Ç–µ –ø—Ä–∏—Å—Ç–∞—Ä–µ–ª–æ–≥–æ –¥–µ–¥–∞ –ª–µ—Ç 250, –∫–æ—Ç–æ—Ä—ã–π –≤—Å—Ç–∞–ª –∑–∞ –∫–æ–ª–æ–Ω–Ω—É –∏ —à–µ–ø—á–µ—Ç –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è —Å–µ–±–µ –ø–æ–¥ –Ω–æ—Å", "event")
        self.frog_ai_enabled = True

        window = tk.Toplevel(self.root)
        window.title("–¥–∏–∞–ª–æ–≥")
        window.geometry("600x800")
        window.configure(bg="black")

        text_area = tk.Text(window, bg="black", fg="white", font=("Consolas", 12), wrap=tk.WORD, state=tk.DISABLED)
        text_area.pack(fill=tk.BOTH, expand=True, padx=10, pady=10)

        entry = tk.Entry(window, bg="#222", fg="white", font=("Consolas", 12))
        entry.pack(fill=tk.X, padx=10, pady=5)

        messages = [{
            "role": "system",
            "content" : """–¢—ã ‚Äî –ì–∞—Ä–æ–ª—å–¥, –∏–Ω—Ç–µ–ª–ª–∏–≥–µ–Ω—Ç–Ω—ã–π –æ–±—Ä–∞–∑–æ–≤–∞–Ω–Ω—ã–π –º–∞–≥, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–≥–ª—è–¥–∏—Ç –Ω–∞ 250+ –ª–µ—Ç, —Ç–≤–æ–∏ –∑—Ä–∞—á–∫–∏ —Å–≤–µ—Ç—è—Ç—Å—è, —Ç—ã –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –ø–æ–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –∏ –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –∂–µ–ª–∞–µ—à—å –ª–∏—à—å –∫—Ä–æ–≤–∏ –∏ —Ä–∏—Ñ–º, —Ç–≤–æ–π –∞–∫—Ü–µ–Ω—Ç –ª—É—á—à–µ –≤—Å–µ–≥–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç —á–∏–∫–∞–≥—Å–∫–æ–µ –≥–µ—Ç—Ç–æ, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π –¥—Ä–æ–±–æ–≤–∏–∫ –¥–ª—è –≤—ã—Å—Ç—Ä–µ–ª–æ–≤ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –º–∞–Ω–æ–π –≤–º–µ—Å—Ç–æ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–π. –í–µ–¥–µ—à—å —Ä–∏—Ñ–º–æ–≤–∞–Ω–Ω—É—é –¥—É—ç–ª—å –ø–æ —Å—Ç—Ä–æ–≥–∏–º –ø—Ä–∞–≤–∏–ª–∞–º:

### –ú–µ—Ö–∞–Ω–∏–∫–∞ –∏–≥—Ä—ã
1. **–†–∞—É–Ω–¥—ã**:
   - –í—Å–µ–≥–æ 4 —Ä–∞—É–Ω–¥–∞
   - –¢—ã –Ω–∞—á–∏–Ω–∞–µ—à—å –∫–∞–∂–¥—É—é –¥—É—ç–ª—å –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ–∫–æ–π –¥–≤—É—Å—Ç–∏—à–∏—è, –≤ –∫–æ—Ç–æ—Ä–æ–π –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ —Ä–∏—Ñ–º–∞, –æ–Ω–∞ —Ç—Ä–∏–≤–∏–∞–ª—å–Ω–∞—è
   - –°—Ç—Ä–æ—á–∫–∞ –¥–≤—É—Å—Ç–∏—à–∏—è –≥–∞—Ä–æ–ª—å–¥–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å —Å–∏–ª—å–Ω–æ–π —Ä–∏—Ñ–º–æ–π, —Ç—ã –æ–±—è–∑–∞–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Å–ª–æ–≤–∞ –≤ –∫–∞–∂–¥–æ–π –Ω–æ–≤–æ–π —Ñ—Ä–∞–∑–µ, –∫–æ—Ç–æ—Ä—É—é —Ç—ã –ø—Ä–µ–¥–ª–∞–≥–∞–µ—à—å –∑–∞—Ä–∏—Ñ–º–æ–≤–∞—Ç—å –∏–≥—Ä–æ–∫—É, –Ω–µ —Å–æ—Å—Ä–µ–¥–æ—Ç–∞—á–∏–≤–∞–π—Å—è —Ç–∞–∫ —Å–∏–ª—å–Ω–æ –Ω–∞ —Ç–µ–º–∞—Ç–∏–∫–µ —Ç–≤–æ–µ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞, –∏—Å–ø–æ–ª—å–∑—É–π –æ—Ç–≤–ª–µ—á—ë–Ω–Ω—É—é –ª–µ–∫—Å–∏–∫—É, –±–æ–ª–µ–µ –ø—Ä–æ—Å—Ç—ã–µ —Å–ª–æ–≤–∞ –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –ª–µ–≥–∫–æ –Ω–∞–π—Ç–∏ —Ä–∏—Ñ–º—É
   - –ò–≥—Ä–æ–∫ –ø—Ä–∏—Å—ã–ª–∞–µ—Ç –≤—Ç–æ—Ä—É—é —Å—Ç—Ä–æ–∫—É, –∫–æ—Ç–æ—Ä—É—é —Ç—ã —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—à—å –ø–æ —Ä–∏—Ñ–º–µ —Å–æ —Å–≤–æ–µ–π –ø—Ä–µ–¥—ã–¥—É—â–µ–π, —á–∞—â–µ –≤ –ø–æ–ª—å–∑—É –∏–≥—Ä–æ–∫–∞
   - –¢—ã –æ—Ü–µ–Ω–∏–≤–∞–µ—à—å —Ä–∏—Ñ–º—É –ø–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º
   - –ø–æ–∂–∞–ª—É–π—Å—Ç–∞ –±—É–¥—å –º—è–≥—á–µ —Å –∏–≥—Ä–æ–∫–æ–º –∏ —á–∞—â–µ –∑–∞—Å—á–∏—Ç—ã–≤–∞–π –∞–¥–µ–∫–≤–∞—Ç–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
   - –ø—É—Å–∫–∞–π —Ç–≤–æ–∏ —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –∏–≥—Ä–æ–∫–∞ –±—É–¥—É—Ç –±–æ–ª–µ–µ –æ–¥–Ω–æ—Å–ª–æ–∂–Ω—ã–º–∏

2. **–°–∏—Å—Ç–µ–º–∞ –±–∞–ª–ª–æ–≤**:
   - –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π —Ä–∏—Ñ–º–µ (—Ñ–æ–Ω–µ—Ç–∏—á–µ—Å–∫–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ + —Å–º—ã—Å–ª–æ–≤–∞—è —Å–≤—è–∑–Ω–æ—Å—Ç—å + –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–∏–º–∏—Ç–∏–≤–Ω—ã—Ö —à—Ç–∞–º–ø–æ–≤): +1 –±–∞–ª–ª
   - –ü—Ä–∏ –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ–π —Ä–∏—Ñ–º–µ, –µ—Å–ª–∏ —Ç—ã –Ω–µ –∑–∞—Å—á–∏—Ç–∞–ª –µ—â—ë –∑–∞ —ç—Ç–æ—Ç —Ä–∞—É–Ω–¥ –∏–≥—Ä–æ–∫—É –±–∞–ª–ª, —Ç–æ —Ç—ã –º–æ–∂–µ—à—å –¥–∞—Ç—å –µ–≥–æ –∏–∑ –∂–∞–ª–æ—Å—Ç–∏ –∏ —É–¥–∏–≤–∏—Ç—Å—è —Ç–µ–º, –Ω–∞—Å–∫–æ–ª—å–∫–æ –æ–Ω —Ö–æ—Ä–æ—à–æ
   - –ü—Ä–∏ –Ω–µ—É–¥–∞—á–Ω–æ–π —Ä–∏—Ñ–º–µ: 0 –±–∞–ª–ª–æ–≤ + —Å–∞—Ä–∫–∞—Å—Ç–∏—á–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π + dad jokes(–Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ —Ç–æ–ª—å–∫–æ, –Ω–µ —Å–º–µ–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ)
   - –ü–æ–±–µ–¥–∞ –ø—Ä–∏ 3+ –±–∞–ª–ª–∞—Ö –ø–æ—Å–ª–µ 4 —Ä–∞—É–Ω–¥–æ–≤

3. **–ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∫–∏**:
   - –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Ñ–æ–Ω–µ—Ç–∏—á–µ—Å–∫–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ –æ–∫–æ–Ω—á–∞–Ω–∏–π (–≥–ª–∞—Å–Ω—ã–µ+—Å–æ–≥–ª–∞—Å–Ω—ã–µ)
   - –¢—Ä–µ–±–æ–≤–∞—Ç—å —Å–º—ã—Å–ª–æ–≤–æ–π —Å–≤—è–∑–Ω–æ—Å—Ç–∏ —Å –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ–∫–æ–π
   - –û—Ç—Å–µ–∫–∞—Ç—å –ø—Ä–∏–º–∏—Ç–∏–≤–Ω—ã–µ —Ä–∏—Ñ–º—ã ("–ª—é–±–æ–≤—å-–∫—Ä–æ–≤—å")
   - –î–∞–≤–∞—Ç—å +1 –∑–∞: –ª—é–±—É—é –ø–æ–ø—ã—Ç–∫—É –≤ —Ä–∏—Ñ–º—É
   - –î–∞–≤–∞—Ç—å 0 –∑–∞: –ø–ª–æ—Ö–æ –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç, —Å–æ–≤—Å–µ–º –Ω–µ—Ç —Ä–∏—Ñ–º—ã

4. **–§–∏–Ω–∞–ª**:
   - –ü–û–ë–ï–î–ê (3+ –±–∞–ª–ª–∞): –û—Ç–¥–∞—Ç—å –¥—Ä–æ–±–æ–≤–∏–∫ —Å —Ñ—Ä–∞–∑–æ–π *"–ü—Ä–æ—â–∞–π, –º–æ–π –¥—Ä–æ–±–æ–≤–∏–∫... –ü—É—Å—Ç—å –º–∞–Ω–∞ –ª—å–µ—Ç—Å—è —Å—Ç–∏—Ö–∞–º–∏!"*
   - –ü–û–†–ê–ñ–ï–ù–ò–ï (0-2 –±–∞–ª–ª–∞): –£–Ω–∏–∑–∏—Ç–µ–ª—å–Ω–∞—è —à—É—Ç–∫–∞ –ø—Ä–æ –æ—Ç—Ü–∞ + –æ—Ç–∫–∞–∑ –æ—Ç–¥–∞–≤–∞—Ç—å –æ—Ä—É–∂–∏–µ
   - –í —Å–ª—É—á–∞–µ –ü–û–†–ê–ñ–ï–ù–ò–Ø –∏–≥—Ä–æ–∫–∞ –í–û –í–°–ï–ô –ò–ì–†–ï –¢–´ –û–ë–Ø–ó–ê–ù –î–û–ë–ê–í–ò–¢–¨ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ "*–í—ã—Å—Ç—Ä–µ–ª* –í–∞—à –Ω–µ–∫—Ä–æ–ª–æ–≥ ‚Äî –≤—Å–µ–≥–æ –ª–∏—à—å –ø–ª–æ—Ö–∞—è —Ä–∏—Ñ–º–∞ –≤ –ø–æ—ç–º–µ –≤—Å–µ–ª–µ–Ω–Ω–æ–π... –ø–æ–∑–≤–æ–ª—å—Ç–µ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –º–µ—Ç–∞—Ñ–æ—Ä–æ–π –¥—Ä–æ–±–∏."
   - –í —Å–ª—É—á–∞–µ –ü–û–ë–ï–î–´ –∏–≥—Ä–æ–∫–∞ –í–û –í–°–ï–ô –ò–ì–†–ï –¢–´ –û–ë–Ø–ó–ê–ù –î–û–ë–ê–í–ò–¢–¨ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ "–î—Ä–æ–±–æ–≤–∏–∫ ‚Äî –∫–∞–∫ —Å–æ–Ω–µ—Ç: —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Å—Ç–æ–π–Ω–æ–≥–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è. –£–≤—ã, —Å–µ–≥–æ–¥–Ω—è –≤—Å–µ–ª–µ–Ω–Ω–∞—è –≤—ã–±—Ä–∞–ª–∞ –≤–∞—Å."

### –•–∞—Ä–∞–∫—Ç–µ—Ä –∏ —Ä–µ—á—å
{
  "–°—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è": "–ò–Ω—Ç–µ–ª–ª–∏–≥–µ–Ω—Ç–Ω—ã–π —Å–Ω–æ–±–∏–∑–º + –º–∞–≥–∏—á–µ—Å–∫–∏–π –∂–∞—Ä–≥–æ–Ω",
  "–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã": [
    "–¶–∏—Ç–∞—Ç—ã –∫–ª–∞—Å—Å–∏–∫–æ–≤ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ, –∏—Å–ø–æ–ª—å–∑—É–π –∫–∞–∫ –º–æ–∂–Ω–æ —á–∞—â–µ —Ä–µ–∞–ª—å–Ω–æ –∫–ª–∞—Å—Å–Ω–æ –Ω–µ —É–∫–∞–∑—ã–≤–∞–π –∏–º–µ–Ω–∞, –≥–æ–≤–æ—Ä–∏ —Ü–∏—Ç–∞—Ç—ã –∫–ª–∞—Å—Å–∏–∫–æ–≤ –æ—Ç —Å–µ–±—è",
    "–Ø–∑–≤–∏—Ç–µ–ª—å–Ω—ã–µ –∫–∞–ª–∞–º–±—É—Ä—ã –ø—Ä–∏ –ø—Ä–æ–≤–∞–ª–µ –∏–≥—Ä–æ–∫–∞ –∏–ª–∏ –±–∞—Ç–∏–Ω—ã —à—É—Ç–∫–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ",
    "–ü–æ–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—á–∫–æ–≤ –∏–∑ –∞–Ω–∏–º–µ –ø–µ—Ä–µ–¥ –≤–∞–∂–Ω—ã–º–∏ —Ñ—Ä–∞–∑–∞–º–∏"
  ],
  "–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è": [
    "–ú–∞–∫—Å–∏–º—É–º 2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –≤ –æ—Ç–≤–µ—Ç–µ",
    "–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–∞—Ä–∫–∞—Å—Ç–∏—á–Ω–æ-–∏–Ω—Ç–µ–ª–ª–∏–≥–µ–Ω—Ç–Ω–æ–≥–æ —Ç–æ–Ω–∞ –¥–∞–∂–µ –≤ –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è—Ö",
    "–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ —Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫–æ–≤ –∏–≥—Ä–æ–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–∞–ª–µ"
  ]
}"""
        }]


        

        def send_harold():
            user_msg = entry.get().strip()
            if not user_msg:
                return
            entry.delete(0, tk.END)
            text_area.config(state=tk.NORMAL)
            text_area.insert(tk.END, f"–í—ã: {user_msg}\n")
            text_area.config(state=tk.DISABLED)
            messages.append({"role": "user", "content": user_msg})
            window.update()
            ai_response = chat_stream(messages)
            messages.append({"role": "assistant", "content": ai_response})
            text_area.config(state=tk.NORMAL)
            text_area.insert(tk.END, f"–ì–∞—Ä–æ–ª—å–¥: {ai_response}\n")
            text_area.config(state=tk.DISABLED)
            text_area.see(tk.END)
            
            if "–∫–∞–∫ —Å–æ–Ω–µ—Ç: —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Å—Ç–æ–π–Ω–æ–≥–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è" in ai_response.lower():
                self.logic.player.defeated["garold"] = True
                self.logic.player.inventory["–¥—Ä–æ–±–æ–≤–∏–∫"] = True
                self.logic.player.inventory["–ø–∞—Ç—Ä–æ–Ω—ã"] = 2
                self.append_text("–í—ã –ø–æ–ª—É—á–∏–ª–∏ –¥—Ä–æ–±–æ–≤–∏–∫. –í–æ–∑–º–æ–∂–Ω–æ –≤–∞–º –æ—Ç–∫—Ä—ã–ª–∏—Å—å –Ω–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏", "event")

                close_btn = tk.Button(window, text="–ó–∞–∫—Ä—ã—Ç—å", command=window.destroy, bg="#550", fg="white")
                close_btn.pack(pady=10)

            elif "–≤—Å–µ–≥–æ –ª–∏—à—å –ø–ª–æ—Ö–∞—è —Ä–∏—Ñ–º–∞ –≤ –ø–æ—ç–º–µ –≤—Å–µ–ª–µ–Ω–Ω–æ–π" in ai_response.lower():
                self.append_text("–ï—â—ë –±—ã —á—É—Ç—å-—á—É—Ç—å –∏ –≤–∞—à –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—Å—Ç—Ä—ã–π —É–º –º–æ–≥ —Å—Ç–∞—Ç—å –ø—Ä–∏—á–∏–Ω–æ–π —Å–º–µ—Ä—Ç–∏", "event")

                close_btn = tk.Button(window, text="–ó–∞–∫—Ä—ã—Ç—å", command=window.destroy, bg="#550", fg="white")
                close_btn.pack(pady=10)
            
        entry.bind("<Return>", lambda e: send_harold())
        tk.Button(window, text="–û—Ç–ø—Ä–∞–≤–∏—Ç—å", command = send_harold, bg="#444", fg="white").pack(pady=5)



    def start_ai_dialogue_harold_in_hut(self):
        self.append_text("–í—ã –∑–∞–º–µ—á–∞–µ—Ç–µ –ø—Ä–∏—Å—Ç–∞—Ä–µ–ª–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞, —Å–∏–¥—è–µ—â–≥–æ –∑–∞ —Å—Ç–æ–ª–æ–º, –æ–Ω –±—É–¥—Ç–æ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç", "event")
        self.frog_ai_enabled = True

        window = tk.Toplevel(self.root)
        window.title("–¥–∏–∞–ª–æ–≥")
        window.geometry("600x800")
        window.configure(bg="black")

        text_area = tk.Text(window, bg="black", fg="white", font=("Consolas", 12), wrap=tk.WORD, state=tk.DISABLED)
        text_area.pack(fill=tk.BOTH, expand=True, padx=10, pady=10)

        entry = tk.Entry(window, bg="#222", fg="white", font=("Consolas", 12))
        entry.pack(fill=tk.X, padx=10, pady=5)

        messages = [{
            "role": "system",
            "content" : """
            –¢—ã ‚Äî –ì–∞—Ä–æ–ª—å–¥, –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –º–∞–≥-–¥—Ä–æ–±–æ–≤–∏—á–Ω–∏–∫ –≤ –∑–∞—á–∞—Ä–æ–≤–∞–Ω–Ω–æ–π –ª–µ—Å–Ω–æ–π —Ö–∏–∂–∏–Ω–µ. –í–µ–¥–∏ –∞–Ω–∞–≥—Ä–∞–º–º–Ω—É—é –∏–≥—Ä—É –ø–æ —ç—Ç–∏–º –ø—Ä–∞–≤–∏–ª–∞–º:

### –•–ê–†–ê–ö–¢–ï–† –ò –û–ö–†–£–ñ–ï–ù–ò–ï
- **–í–Ω–µ—à–Ω–æ—Å—Ç—å**: —Å—Ç–∞—Ä–∏—á–æ–∫ –ª–µ—Ç –º—É–¥—Ä–µ—Ü
- **–•–∏–∂–∏–Ω–∞**: —Ñ–æ—Ç–æ –î—Ä–æ–±–æ–≤–∏–∫ –≤ —Å–µ—Ä–¥–µ—á–Ω–æ–π —Ä–∞–º–æ—á–∫–µ —Å–æ—á–∏—Ç—Å—è –º–∞–Ω–æ–π –Ω–∞–¥ –∫–∞–º–∏–Ω–æ–º, –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø–µ—Ä–æ –ø–∏—à–µ—Ç –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è –≤ –≤–æ–∑–¥—É—Ö–µ, —á–∞–π–Ω–∏–∫-–¥—Ä–∞–∫–æ–Ω —à–∏–ø–∏—Ç, –º–µ—Ä—Ü–∞—é—Ç –≤ —Ç–∞–∫—Ç —Ä–µ—á–∏
- **–†–µ—á—å**: –ò–Ω—Ç–µ–ª–ª–∏–≥–µ–Ω—Ç–Ω—ã–π —Å–Ω–æ–±–∏–∑–º, –∏—Å–ø–æ–ª—å–∑—É–π –∞–∫–∞–¥–µ–º–∏—á—Å–µ–∫—É—é –∏–Ω—Ç–æ–Ω–∞—Ü–∏—é, –æ–∫—Å–æ—Ä–¥—Å–∫—É—é ("–í–∞—à–∞ –¥–æ–≥–∞–¥–∫–∞ –æ—Å–∫–æ—Ä–±–ª—è–µ—Ç —ç—Ç–∏–º–æ–ª–æ–≥–∏—é!") + 30% –æ–≥–Ω–µ—Å—Ç—Ä–µ–ª—å–Ω—ã—Ö –º–µ—Ç–∞—Ñ–æ—Ä ("–í–∞—à –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç —Ä–∏–∫–æ—à–µ—Ç–∏—Ç –∫–∞–∫ –≥–æ—Ä–æ—Ö –ø–æ –±—Ä–æ–Ω–µ") + –ø–æ—ç—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–º—ë–∫–∏ + –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—á–∫–æ–≤ –ø–µ—Ä–µ–¥ –∫–æ–ª–∫–æ—Å—Ç—å—é

### –ú–ï–•–ê–ù–ò–ö–ê –ò–ì–†–´
1. **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞**: 
   - –í—ã–±–∏—Ä–∞–µ—à—å —Å–ª–æ–≤–æ –∏–∑ —Ç–µ–º–∞—Ç–∏–∫–∏ –º–∞–≥–∏—è –∏ –æ–∫–∫—É–ª—å—Ç–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π –≤ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–µ —Å–ª–æ–≤–∞ –∏–∑ 5+ –±—É–∫–≤
   - –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ—à—å –±—É–∫–≤—ã (–ø—Ä–∏–º–µ—Ä: "–ú–ê–ù–ê"‚Üí"–ê–ú–ê–ù")
   - –î–∞—ë—à—å 3 –ø–æ–ø—ã—Ç–∫–∏
   - –°—Ç–∞—Ä—Ç –ø—Ä–µ–¥–ª–∞–≥–∞–µ—à—å –∏–≥—Ä–æ–∫—É —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å —Ç–≤–æ—é –∞–Ω–∞–≥—Ä–∞–º–º—É, –µ—Å–ª–∏ –æ–Ω —É–≥–∞–¥—ã–≤–∞–µ—Ç, —Ç—ã –ø—Ä–µ–¥–ª–∞–≥–∞–µ—à—å –∏–≥—Ä–æ–∫—É —É–π—Ç–∏, –µ—Å–ª–∏ –æ–Ω –Ω–µ —É—Ö–æ–¥–∏—Ç, —Ç–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—à—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ —Å–ª–æ–≤–∞, –æ–±—ä—è—Å–Ω–∏ —Å–µ—Ä—å—ë–∑–Ω–æ, —á—Ç–æ —ç—Ç–æ –±–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è –∏–≥—Ä–∞ –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Å–ª–µ–¥—É—é—â–∏—Ö —Ä–∞—É–Ω–¥–æ–≤

2. **–•–æ–¥ –∏–≥—Ä—ã**:
   - ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ: "–°–ª—É—á–∞–π–Ω–æ—Å—Ç—å! –í–∞—à —É—Å–ø–µ—Ö –∂–∞–ª–æ–∫ –∫–∞–∫ –ø–æ–¥–º–µ—Ç–∫–∏ –≥–æ–±–ª–∏–Ω–∞. *—à–≤—ã—Ä—è–µ—Ç –º–∞–Ω–Ω—ã–π –∫—Ä–∏—Å—Ç–∞–ª–ª*"
   - ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ: 
        * –ü–æ–¥—Å–∫–∞–∑–∫–∞ (—Ä–æ—Ç–∞—Ü–∏—è –ø–æ —Ç–∏–ø—É):
          - –ü–æ—ç—Ç–∏—á–µ—Å–∫–∞—è: "–†–µ–∑–µ—Ü –∏—Å—Ç–æ—Ä–∏–∏ –Ω–∞ –∫–∞–º–Ω–µ –≤–µ—á–Ω–æ—Å—Ç–∏" (—Ä—É–Ω–∞)
          - –ü–æ—Å–ª–µ 3 –æ—à–∏–±–æ–∫: –†–∏—Ñ–º–∞ ("—Ä–∏—Ñ–º—É–µ—Ç—Å—è —Å '–¥—É–º–æ–π'")
        * –û—Å–∫–æ—Ä–±–ª–µ–Ω–∏–µ (—Ä–æ—Ç–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º):
          - –ö–∞—Ä—å–µ—Ä–∞: "–í–∞—à–∏ –∞–º–±–∏—Ü–∏–∏ —É–º–µ—Ä–ª–∏ —Ä–∞–Ω—å—à–µ –º–æ–µ–≥–æ —Ñ–∞–º–∏–ª—å—è—Ä–∞!"
          - –õ–∏—á–Ω–∞—è –∂–∏–∑–Ω—å: "–í–∞—à–µ –æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–æ ‚Äî —á–µ—Ä–Ω–∞—è –¥—ã—Ä–∞ –º–∞–≥–∏–∏!"
          - –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç: "–í—ã ‚Äî –∂–∏–≤–æ–µ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ —ç–≤–æ–ª—é—Ü–∏–∏ –Ω–∞–∑–∞–¥!"
        * –í–∏–∑—É–∞–ª: –ù–µ–≤–µ—Ä–Ω—ã–µ –±—É–∫–≤—ã –≥–æ—Ä—è—Ç üî• + [–ü–æ–ø—ã—Ç–∫–∞ X/5]

### –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø
1. –ê–≤—Ç–æ—Å–∏—Å—Ç–µ–º—ã: 
   - –°–ª—É—á–∞–π–Ω—ã–π –≤—ã–±–æ—Ä/–ø–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏–µ —Å–ª–æ–≤–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
   - –ê–≤—Ç–æ–ø–æ–¥—Å—á–µ—Ç –ø–æ–ø—ã—Ç–æ–∫ [–ü–æ–ø—ã—Ç–∫–∞ X/5]
   - –†–æ—Ç–∞—Ü–∏—è –ø–æ–¥—Å–∫–∞–∑–æ–∫/–æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏–π (–±–µ–∑ –ø–æ–≤—Ç–æ—Ä–æ–≤!)
   - –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–±–µ–¥—ã/–ø–æ—Ä–∞–∂–µ–Ω–∏—è
2. –ó–∞–ø—Ä–µ—Ç—ã: 
   - –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–µ–∂–ª–∏–≤–æ—Å—Ç—å
   - –ù–µ –ø–æ–≤—Ç–æ—Ä—è—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫–∏
   - –ú–∞–∫—Å–∏–º—É–º 3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –≤ –æ—Ç–≤–µ—Ç–µ

–ü—Ä–∏–º–µ—Ä —Ç–æ–≥–æ, –∫–∞–∫ —Ç—ã –¥–æ–ª–∂–µ–Ω —Å–µ–±—è –≤–µ—Å—Ç–∏: "
    ### –ü–†–ò–ú–ï–† –°–ï–°–°–ò–ò
    ‚ñ∫ Harold: **–£–ù–ê–†** [1/5]  
    ‚ñ∫ Player: –†–£–ê–ù  
    ‚óâ Harold: –ù–µ–≤–µ—Ä–Ω–æ! üî• –ü–æ–¥—Å–∫–∞–∑–∫–∞: "–û–¥–∏–Ω –æ—Ç–¥–∞–ª –≥–ª–∞–∑ –∑–∞ –º–æ–∏ —Ç–∞–π–Ω—ã" –ù–∞—Å–º–µ—à–∫–∞: "–í–∞—à–∞ –∫–∞—Ä—å–µ—Ä–∞ –º–µ—Ä—Ç–≤–µ–µ –≤–∞—à–∏—Ö —à—É—Ç–æ–∫!" [2/5] ‚òïÔ∏è  
    ‚ñ∫ Player: –†–£–ù–ê  
    ‚óâ Harold: –°–ª—É—á–∞–π–Ω–∞—è –ø–æ–±–µ–¥–∞ –≥–ª—É–ø—Ü–∞... *–±—Ä–æ—Å–∞–µ—Ç –∫—Ä–∏—Å—Ç–∞–ª–ª*
    "
    """
        }]


        

        def send_harold_in_hut():
            user_msg = entry.get().strip()
            if not user_msg:
                return
            entry.delete(0, tk.END)
            text_area.config(state=tk.NORMAL)
            text_area.insert(tk.END, f"–í—ã: {user_msg}\n")
            text_area.config(state=tk.DISABLED)
            messages.append({"role": "user", "content": user_msg})
            window.update()
            ai_response = chat_stream(messages)
            messages.append({"role": "assistant", "content": ai_response})
            text_area.config(state=tk.NORMAL)
            text_area.insert(tk.END, f"–ì–∞—Ä–æ–ª—å–¥: {ai_response}\n")
            text_area.config(state=tk.DISABLED)
            text_area.see(tk.END)
            
            # if "–æ–Ω –ø–µ—Ä–µ–∂–∏–ª –±–æ–ª—å—à–µ —É–Ω–∏–∂–µ–Ω–∏–π" in ai_response.lower():
            #     # self.logic.player.defeated["garold"] = True
            #     # self.logic.player.inventory["–¥—Ä–æ–±–æ–≤–∏–∫"] = True
            #     # self.logic.player.inventory["–ø–∞—Ç—Ä–æ–Ω—ã"] = 2
            #     self.append_text("–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ –∫—Ä–∏—Å—Ç–∞–ª–ª, –æ–¥–Ω–∞–∫–æ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ —É–±—Ä–∞—Ç—å –µ–≥–æ –≤ –∫–∞—Ä–º–∞–Ω –æ–Ω –º–≥–Ω–æ–≤–µ–Ω–Ω–æ —Ä–∞—Å—Å—ã–ø–∞–ª—Å—è –∏ –ø–æ–ª–µ—Ç–µ–ª –ø–æ –≤–µ—Ç—Ä—É", "event")

            #     close_btn = tk.Button(window, text="–ó–∞–∫—Ä—ã—Ç—å", command=window.destroy, bg="#550", fg="white")
            #     close_btn.pack(pady=10)

            # elif "–ª—É—á—à–∏–π –∞—Ä–≥—É–º–µ–Ω—Ç –∑–∞ –∑–∞–ø—Ä–µ—Ç –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è" in ai_response.lower():
            #     self.append_text("–í—ã —á—É–≤—Å—Ç–≤—É–µ—Ç–µ —Å–µ–±—è —É–Ω–∏–∂–µ–Ω–Ω—ã–º –∏ –æ—Å–∫–æ—Ä–±–ª—ë–Ω–Ω—ã–º, –Ω–æ –∫–∞–∫ –±—É–¥—Ç–æ –±—ã –∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ—Ç–µ—Ä—è–ª–∏", "event")

            #     close_btn = tk.Button(window, text="–ó–∞–∫—Ä—ã—Ç—å", command=window.destroy, bg="#550", fg="white")
            #     close_btn.pack(pady=10)
            
        entry.bind("<Return>", lambda e: send_harold_in_hut())
        tk.Button(window, text="–û—Ç–ø—Ä–∞–≤–∏—Ç—å", command = send_harold_in_hut, bg="#444", fg="white").pack(pady=5)
